{"version":3,"file":"ol-geocoder.js","sources":["../src/konstants/index.js","../src/helpers/mix.js","../src/helpers/dom.js","../src/html.js","../src/helpers/ajax.js","../src/providers/bing.js","../src/providers/mapquest.js","../src/providers/opencage.js","../src/providers/osm.js","../src/providers/photon.js","../src/nominatim.js","../src/base.js"],"sourcesContent":["export {\n  default as VARS,\n}\nfrom './vars.json';\n\nexport const EVENT_TYPE = {\n  ADDRESSCHOSEN: 'addresschosen',\n};\n\nexport const CONTROL_TYPE = {\n  NOMINATIM: 'nominatim',\n  REVERSE: 'reverse',\n};\n\nexport const TARGET_TYPE = {\n  GLASS: 'glass-button',\n  INPUT: 'text-input',\n};\n\nexport const FEATURE_SRC = 'data:image/svg+xml;charset=utf-8,' +\n  '<svg width=\"26\" height=\"42\" viewBox=\"0 0 26 42\" xmlns=\"http://www.w3.org/2000/svg\">' +\n  '<polygon points=\"1,18 14,42 25,18\" fill=\"rgb(75,75,75)\" />' +\n  '<ellipse cx=\"13\" cy=\"13\" rx=\"13\" ry=\"13\" fill=\"rgb(75,75,75)\" />' +\n  '<ellipse cx=\"13\" cy=\"14\" rx=\"6\" ry=\"6\" fill=\"yellow\" />' +\n  '</svg>'; // #285\n\nexport const PROVIDERS = {\n  BING: 'bing',\n  MAPQUEST: 'mapquest',\n  OPENCAGE: 'opencage',\n  OSM: 'osm',\n  PHOTON: 'photon',\n};\n\nexport const APIS = {\n  BING: 'https://dev.virtualearth.net/REST/v1/Locations',\n  MAPQUEST: 'https://nominatim.openstreetmap.org/search', // #286\n  OPENCAGE: 'https://api.opencagedata.com/geocode/v1/json?',\n  OSM: 'https://nominatim.openstreetmap.org/search',\n  PHOTON: 'https://photon.komoot.io/api/',\n};\n\nexport const DEFAULT_OPTIONS = {\n  provider: PROVIDERS.OSM,\n  label: '',\n  placeholder: 'Search for an address',\n  featureStyle: null,\n  targetType: TARGET_TYPE.GLASS,\n  lang: 'en-US',\n  limit: 5,\n  keepOpen: false,\n  preventDefault: false,\n  preventPanning: false,\n  preventMarker: false,\n  defaultFlyResolution: 10, // Meters per pixel\n  debug: false,\n};","/* global window, performance */\n\nexport function assert(condition, message = 'Assertion failed') {\n  if (!condition) {\n    if (typeof Error !== 'undefined') throw new Error(message);\n\n    throw message; // Fallback\n  }\n}\n\nexport function now() {\n  // Polyfill for window.performance.now()\n  // @license http://opensource.org/licenses/MIT\n  // copyright Paul Irish 2015\n  // https://gist.github.com/paulirish/5438650\n  if ('performance' in window === false) {\n    window.performance = {};\n  }\n\n  if ('now' in window.performance === false) {\n    let nowOffset = Date.now();\n\n    if (performance.timing && performance.timing.navigationStart) {\n      nowOffset = performance.timing.navigationStart;\n    }\n\n    window.performance.now = () => Date.now() - nowOffset;\n  }\n\n  return window.performance.now();\n}\n\nexport function randomId(prefix) {\n  const id = now().toString(36);\n\n  return prefix ? prefix + id : id;\n}\n\nexport function isNumeric(str) {\n  return /^\\d+$/u.test(str);\n}\n\nexport function isEmpty(str) {\n  return !str || str.length === 0;\n}\n\nexport function emptyArray(array) {\n  while (array.length) array.pop();\n}\n\nexport function anyMatchInArray(source, target) {\n  return source.some((each) => target.includes(each));\n}\n\nexport function everyMatchInArray(arr1, arr2) {\n  return arr2.every((each) => arr1.includes(each));\n}\n\nexport function anyItemHasValue(obj, has = false) {\n  const keys = Object.keys(obj);\n\n  keys.forEach((key) => {\n    if (!isEmpty(obj[key])) has = true;\n  });\n\n  return has;\n}","/* global window, document, HTMLElement */\n\n/* eslint-disable prefer-named-capture-group */\nimport {\n  isNumeric\n} from './mix';\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String|Array<String>} classname Class or array of classes.\n * For example: 'class1 class2' or ['class1', 'class2']\n * @param {Number|undefined} timeout Timeout to remove a class.\n */\nexport function addClass(element, classname, timeout) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => addClass(each, classname));\n\n    return;\n  }\n\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\n\n  let i = array.length;\n\n  while (i--) {\n    if (!hasClass(element, array[i])) {\n      _addClass(element, array[i], timeout);\n    }\n  }\n}\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String|Array<String>} classname Class or array of classes.\n * For example: 'class1 class2' or ['class1', 'class2']\n * @param {Number|undefined} timeout Timeout to add a class.\n */\nexport function removeClass(element, classname, timeout) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => removeClass(each, classname, timeout));\n\n    return;\n  }\n\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\n\n  let i = array.length;\n\n  while (i--) {\n    if (hasClass(element, array[i])) {\n      _removeClass(element, array[i], timeout);\n    }\n  }\n}\n\n/**\n * @param {Element} element DOM node.\n * @param {String} classname Classname.\n * @return {Boolean}\n */\nexport function hasClass(element, c) {\n  // use native if available\n  return element.classList ? element.classList.contains(c) : classRegex(c).test(element.className);\n}\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String} classname Classe.\n */\nexport function toggleClass(element, classname) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => toggleClass(each, classname));\n\n    return;\n  }\n\n  // use native if available\n  if (element.classList) {\n    element.classList.toggle(classname);\n  } else {\n    hasClass(element, classname) ? _removeClass(element, classname) : _addClass(element, classname);\n  }\n}\n\n/**\n * Abstraction to querySelectorAll for increased\n * performance and greater usability\n * @param {String} selector\n * @param {Element} context (optional)\n * @param {Boolean} findAll (optional)\n * @return (findAll) {Element} : {Array}\n */\nexport function $(id) {\n  id = id[0] === '#' ? id.slice(1, 1 + id.length) : id;\n\n  return document.getElementById(id);\n}\n\nexport function isElement(obj) {\n  // DOM, Level2\n  if ('HTMLElement' in window) {\n    return !!obj && obj instanceof HTMLElement;\n  }\n\n  // Older browsers\n  return !!obj && typeof obj === 'object' && obj.nodeType === 1 && !!obj.nodeName;\n}\n\nexport function getAllChildren(node, tag) {\n  return [].slice.call(node.getElementsByTagName(tag));\n}\n\nexport function removeAllChildren(node) {\n  while (node.firstChild) node.firstChild.remove();\n}\n\nexport function removeAll(collection) {\n  let node;\n\n  while ((node = collection[0])) node.remove();\n}\n\nexport function getChildren(node, tag) {\n  return [].filter.call(node.childNodes, (el) =>\n    tag ? el.nodeType === 1 && el.tagName.toLowerCase() === tag : el.nodeType === 1\n  );\n}\n\nexport function template(html, row) {\n  return html.replace(/\\{\\s*([\\w-]+)\\s*\\}/gu, (htm, key) => {\n    const value = row[key] === undefined ? '' : row[key];\n\n    return htmlEscape(value);\n  });\n}\n\nexport function htmlEscape(str) {\n  return String(str)\n    .replaceAll('&', '&amp;')\n    .replaceAll('<', '&lt;')\n    .replaceAll('>', '&gt;')\n    .replaceAll('\"', '&quot;')\n    .replaceAll(\"'\", '&#039;');\n}\n\nexport function createElement(node, html) {\n  let elem;\n\n  if (Array.isArray(node)) {\n    elem = document.createElement(node[0]);\n\n    if (node[1].id) elem.id = node[1].id;\n\n    if (node[1].classname) elem.className = node[1].classname;\n\n    if (node[1].attr) {\n      const {\n        attr\n      } = node[1];\n\n      if (Array.isArray(attr)) {\n        let i = -1;\n\n        while (++i < attr.length) {\n          elem.setAttribute(attr[i].name, attr[i].value);\n        }\n      } else {\n        elem.setAttribute(attr.name, attr.value);\n      }\n    }\n  } else {\n    elem = document.createElement(node);\n  }\n\n  elem.innerHTML = html;\n\n  const frag = document.createDocumentFragment();\n\n  while (elem.childNodes[0]) frag.append(elem.childNodes[0]);\n\n  elem.append(frag);\n\n  return elem;\n}\n\nfunction classRegex(classname) {\n  return new RegExp(`(^|\\\\s+) ${classname} (\\\\s+|$)`, 'u');\n}\n\nfunction _addClass(el, klass, timeout) {\n  // use native if available\n  if (el.classList) {\n    el.classList.add(klass);\n  } else {\n    el.className = `${el.className} ${klass}`.trim();\n  }\n\n  if (timeout && isNumeric(timeout)) {\n    window.setTimeout(() => _removeClass(el, klass), timeout);\n  }\n}\n\nfunction _removeClass(el, klass, timeout) {\n  if (el.classList) {\n    el.classList.remove(klass);\n  } else {\n    el.className = el.className.replace(classRegex(klass), ' ').trim();\n  }\n\n  if (timeout && isNumeric(timeout)) {\n    window.setTimeout(() => _addClass(el, klass), timeout);\n  }\n}","import {\n  VARS,\n  TARGET_TYPE\n} from './konstants';\n\nimport {\n  createElement\n} from './helpers/dom';\n\nconst klasses = VARS.cssClasses;\n\n/**\n * @class Html\n */\nexport default class Html {\n  /**\n   * @constructor\n   * @param {object} options Options.\n   */\n  constructor(options) {\n    this.options = options;\n    this.els = this.createControl();\n  }\n\n  createControl() {\n    let container;\n    let containerClass;\n    let elements;\n\n    if (this.options.targetType === TARGET_TYPE.INPUT) {\n      containerClass = `${klasses.namespace} ${klasses.inputText.container}`;\n      container = createElement(\n        ['div', {\n          id: VARS.containerId,\n          classname: containerClass\n        }],\n        Html.input\n      );\n      elements = {\n        container,\n        control: container.querySelector(`.${klasses.inputText.control}`),\n        label: container.querySelector(`.${klasses.inputText.label}`), // #198\n        input: container.querySelector(`.${klasses.inputText.input}`),\n        search: container.querySelector(`.${klasses.inputText.search}`),\n        result: container.querySelector(`.${klasses.inputText.result}`),\n      };\n      elements.label.innerHTML = this.options.label;\n    } else {\n      containerClass = `${klasses.namespace} ${klasses.glass.container}`;\n      container = createElement(\n        ['div', {\n          id: VARS.containerId,\n          classname: containerClass\n        }],\n        Html.glass\n      );\n      elements = {\n        container,\n        control: container.querySelector(`.${klasses.glass.control}`),\n        button: container.querySelector(`.${klasses.glass.button}`),\n        input: container.querySelector(`.${klasses.glass.input}`),\n        search: container.querySelector(`.${klasses.glass.search}`),\n        result: container.querySelector(`.${klasses.glass.result}`),\n      };\n    }\n\n    // set placeholder from options\n    elements.input.placeholder = this.options.placeholder;\n\n    return elements;\n  }\n}\n\nHtml.glass = `\n  <div class=\"${klasses.glass.control} ${klasses.olControl}\">\n    <button type=\"button\" id=\"${VARS.buttonControlId}\" class=\"${klasses.glass.button}\"></button>\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.glass.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\n    <a id=\"${VARS.inputSearchId}\" class=\"${klasses.glass.search} ${klasses.hidden}\"></a>\n  </div>\n  <ul class=\"${klasses.glass.result}\"></ul>\n`;\n\nHtml.input = `\n  <div class=\"${klasses.inputText.control}\">\n    <label type=\"button\" id=\"${VARS.inputSearchId}\" class=\"${klasses.inputText.label}\"></label>\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.inputText.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\n    <span class=\"${klasses.inputText.icon}\"></span>\n    <button type=\"button\" id=\"${VARS.inputSearchId}\" class=\"${klasses.inputText.search} ${klasses.hidden}\"></button>\n  </div>\n  <ul class=\"${klasses.inputText.result}\"></ul>\n`;","/* global window, document, fetch, setTimeout */\n\nexport function json(obj) {\n  return new Promise((resolve, reject) => {\n    const url = encodeUrlXhr(obj.url, obj.data);\n    const config = {\n      method: 'GET',\n      mode: 'cors',\n      credentials: 'same-origin',\n    };\n\n    if (obj.jsonp) {\n      jsonp(url, obj.callbackName, resolve);\n    } else {\n      fetch(url, config)\n        .then((r) => r.json())\n        .then(resolve)\n        .catch(reject);\n    }\n  });\n}\n\nfunction toQueryString(obj) {\n  return Object.keys(obj)\n    .reduce((acc, k) => {\n      acc.push(\n        typeof obj[k] === 'object' ?\n        toQueryString(obj[k]) :\n        `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`\n      );\n\n      return acc;\n    }, [])\n    .join('&');\n}\n\nfunction encodeUrlXhr(url, data) {\n  if (data && typeof data === 'object') {\n    url += (/\\?/u.test(url) ? '&' : '?') + toQueryString(data);\n  }\n\n  return url;\n}\n\nfunction jsonp(url, key, callback) {\n  // https://github.com/Fresheyeball/micro-jsonp/blob/master/src/jsonp.js\n  const {\n    head\n  } = document;\n  const script = document.createElement('script');\n  // generate minimally unique name for callback function\n  const callbackName = `f${Math.round(Math.random() * Date.now())}`;\n\n  // set request url\n  script.setAttribute(\n    'src',\n    // add callback parameter to the url\n    //    where key is the parameter key supplied\n    //    and callbackName is the parameter value\n    `${url + (url.indexOf('?') > 0 ? '&' : '?') + key}=${callbackName}`\n  );\n\n  // place jsonp callback on window,\n  //  the script sent by the server should call this\n  //  function as it was passed as a url parameter\n  window[callbackName] = (data) => {\n    window[callbackName] = undefined;\n\n    // clean up script tag created for request\n    setTimeout(() => head.removeChild(script), 0);\n\n    // hand data back to the user\n    callback(data);\n  };\n\n  // actually make the request\n  head.append(script);\n}","import {\n  APIS,\n} from '../konstants';\n\n/**\n * @class Bing\n */\nexport default class Bing {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: APIS.BING,\n      callbackName: 'jsonp',\n\n      params: {\n        query: '',\n        key: '',\n        includeNeighborhood: 0,\n        maxResults: 10,\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n      callbackName: this.settings.callbackName,\n\n      params: {\n        query: options.query,\n        key: options.key,\n\n        includeNeighborhood: options.includeNeighborhood || this.settings.params.includeNeighborhood,\n\n        maxResults: options.maxResults || this.settings.params.maxResults,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    const {\n      resources\n    } = results.resourceSets[0];\n\n    if (resources.length === 0) return [];\n\n    return resources.map((result) => ({\n      lon: result.point.coordinates[1],\n      lat: result.point.coordinates[0],\n\n      address: {\n        name: result.name,\n      },\n\n      original: {\n        formatted: result.address.formattedAddress,\n        details: result.address,\n      },\n    }));\n  }\n}","import {\n  APIS,\n} from '../konstants';\n\n/**\n * @class MapQuest\n */\nexport default class MapQuest {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: APIS.MAPQUEST,\n\n      params: {\n        q: '',\n        key: '',\n        format: 'json',\n        addressdetails: 1,\n        limit: 10,\n        countrycodes: '',\n        'accept-language': 'en-US',\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        key: options.key,\n        format: 'json',\n        addressdetails: 1,\n        limit: options.limit || this.settings.params.limit,\n        countrycodes: options.countrycodes || this.settings.params.countrycodes,\n\n        'accept-language': options.lang || this.settings.params['accept-language'],\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.length === 0) return [];\n\n    return results.map((result) => ({\n      lon: result.lon,\n      lat: result.lat,\n\n      address: {\n        name: result.address.neighbourhood || '',\n        road: result.address.road || '',\n        postcode: result.address.postcode,\n        city: result.address.city || result.address.town,\n        state: result.address.state,\n        country: result.address.country,\n      },\n\n      original: {\n        formatted: result.display_name,\n        details: result.address,\n      },\n    }));\n  }\n}","import {\n  APIS,\n} from '../konstants';\n\n/**\n * @class OpenCage\n */\nexport default class OpenCage {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: APIS.OPENCAGE,\n\n      params: {\n        q: '',\n        key: '',\n        limit: 10,\n        countrycode: '',\n        pretty: 1,\n        no_annotations: 1,\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        key: options.key,\n        limit: options.limit || this.settings.params.limit,\n        countrycode: options.countrycodes || this.settings.params.countrycodes,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.results.length === 0) return [];\n\n    return results.results.map((result) => ({\n      lon: result.geometry.lng,\n      lat: result.geometry.lat,\n\n      address: {\n        name: result.components.house_number || '',\n        road: result.components.road || '',\n        postcode: result.components.postcode,\n        city: result.components.city || result.components.town,\n        state: result.components.state,\n        country: result.components.country,\n      },\n\n      original: {\n        formatted: result.formatted,\n        details: result.components,\n      },\n    }));\n  }\n}","import {\n  APIS,\n} from '../konstants';\n\n/**\n * @class OpenStreet\n */\nexport default class OpenStreet {\n  /**\n   * @constructor\n   */\n  constructor(options) {\n    this.settings = {\n      url: APIS.OSM,\n      ...options, // #266 Allow custom URL for osm provider\n      params: {\n        q: '',\n        format: 'json',\n        addressdetails: 1,\n        limit: 10,\n        countrycodes: '',\n        viewbox: '',\n        'accept-language': 'en-US',\n      },\n    };\n  }\n\n  getParameters(opt) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: opt.query,\n        format: this.settings.params.format,\n        addressdetails: this.settings.params.addressdetails,\n        limit: opt.limit || this.settings.params.limit,\n        countrycodes: opt.countrycodes || this.settings.params.countrycodes,\n        viewbox: opt.viewbox || this.settings.params.viewbox, // #260\n        'accept-language': opt.lang || this.settings.params['accept-language'],\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.length === 0) return [];\n\n    return results.map((result) => ({\n      lon: result.lon,\n      lat: result.lat,\n      bbox: result.boundingbox,\n\n      address: {\n        name: result.display_name,\n        road: result.address.road || '',\n        houseNumber: result.address.house_number || '',\n        postcode: result.address.postcode,\n        city: result.address.city || result.address.town,\n        state: result.address.state,\n        country: result.address.country,\n      },\n\n      original: {\n        formatted: result.display_name,\n        details: result.address,\n      },\n    }));\n  }\n}","import {\n  APIS,\n} from '../konstants';\n\n/**\n * @class Photon\n */\nexport default class Photon {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: APIS.PHOTON,\n\n      params: {\n        q: '',\n        limit: 10,\n        lang: 'en',\n      },\n\n      langs: ['de', 'it', 'fr', 'en'],\n    };\n  }\n\n  getParameters(options) {\n    options.lang = options.lang.toLowerCase();\n\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        limit: options.limit || this.settings.params.limit,\n\n        lang: this.settings.langs.includes(options.lang) ? options.lang : this.settings.params.lang,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.features.length === 0) return [];\n\n    return results.features.map((result) => ({\n      lon: result.geometry.coordinates[0],\n      lat: result.geometry.coordinates[1],\n\n      address: {\n        name: result.properties.name,\n        postcode: result.properties.postcode,\n        city: result.properties.city,\n        state: result.properties.state,\n        country: result.properties.country,\n      },\n\n      original: {\n        formatted: result.properties.name,\n        details: result.properties,\n      },\n    }));\n  }\n}","/* global window, console */\n\nimport LayerVector from 'ol/layer/Vector';\nimport SourceVector from 'ol/source/Vector';\nimport Point from 'ol/geom/Point';\nimport Feature from 'ol/Feature';\nimport * as proj from 'ol/proj';\n\nimport {\n  VARS,\n  TARGET_TYPE,\n  PROVIDERS,\n  EVENT_TYPE,\n} from './konstants';\nimport {\n  hasClass,\n  addClass,\n  removeClass,\n  createElement,\n  template,\n  removeAllChildren,\n} from './helpers/dom';\nimport {\n  randomId,\n} from './helpers/mix';\nimport {\n  json,\n} from './helpers/ajax';\n\nimport Bing from './providers/bing';\nimport MapQuest from './providers/mapquest';\nimport OpenCage from './providers/opencage';\nimport OpenStreet from './providers/osm';\nimport Photon from './providers/photon';\n\nconst klasses = VARS.cssClasses;\n\n/**\n * @class Nominatim\n */\nexport default class Nominatim {\n  /**\n   * @constructor\n   * @param {Function} base Base class.\n   */\n  constructor(base, els) {\n    this.Base = base;\n\n    this.layerName = randomId('geocoder-layer-');\n    this.layer = new LayerVector({\n      background: 'transparent', // #282\n      name: this.layerName,\n      source: new SourceVector(),\n      displayInLayerSwitcher: false, // #256 Remove search layer from legend\n    });\n\n    this.options = base.options;\n    // provider is either the name of a built-in provider as a string or an\n    // object that implements the provider API\n    this.options.provider =\n      typeof this.options.provider === 'string' ?\n      this.options.provider.toLowerCase() :\n      this.options.provider;\n    this.provider = this.newProvider();\n\n    this.els = els;\n    this.container = this.els.container;\n    this.registeredListeners = {\n      mapClick: false,\n    };\n    this.setListeners();\n  }\n\n  setListeners() {\n    const openSearch = (evt) => {\n      evt.stopPropagation();\n      hasClass(this.els.control, klasses.glass.expanded) ? this.collapse() : this.expand();\n    };\n    const query = (evt) => {\n      const value = evt.target.value.trim();\n      const hit = evt.key ?\n        evt.key === 'Enter' :\n        evt.which ?\n        evt.which === 13 :\n        evt.keyCode ?\n        evt.keyCode === 13 :\n        false;\n\n      if (hit) {\n        evt.preventDefault();\n        this.query(value);\n      }\n    };\n    const stopBubbling = (evt) => evt.stopPropagation();\n    const search = () => { // #255\n      this.els.input.focus();\n      this.query(this.els.input.value);\n    };\n    const handleValue = (evt) => {\n      const value = evt.target.value.trim();\n\n      value.length !== 0 ?\n        removeClass(this.els.search, klasses.hidden) :\n        addClass(this.els.search, klasses.hidden);\n    };\n\n    this.els.input.addEventListener('keypress', query, false);\n    this.els.input.addEventListener('click', stopBubbling, false);\n    this.els.input.addEventListener('input', handleValue, false);\n    this.els.search.addEventListener('click', search, false);\n\n    if (this.options.targetType === TARGET_TYPE.GLASS) {\n      this.els.button.addEventListener('click', openSearch, false);\n    }\n  }\n\n  query(q) {\n    // lazy provider\n    if (!this.provider) {\n      this.provider = this.newProvider();\n    }\n\n    const parameters = this.provider.getParameters({\n      query: q,\n      key: this.options.key,\n      lang: this.options.lang,\n      countrycodes: this.options.countrycodes,\n      viewbox: this.options.viewbox,\n      limit: this.options.limit,\n    });\n\n    this.clearResults(this.options.keepOpen === false); // #284\n    addClass(this.els.search, klasses.spin);\n\n    const ajax = {\n      url: parameters.url,\n      data: parameters.params,\n    };\n\n    if (parameters.callbackName) {\n      ajax.jsonp = true;\n      ajax.callbackName = parameters.callbackName;\n    }\n\n    json(ajax)\n      .then((res) => {\n        this.options.debug && console.info(res);\n\n        removeClass(this.els.search, klasses.spin);\n\n        // will be fullfiled according to provider\n        const res_ = this.provider.handleResponse(res);\n\n        if (res_) {\n          this.createList(res_);\n          this.listenMapClick();\n        }\n      })\n      .catch(() => {\n        removeClass(this.els.search, klasses.spin);\n\n        const li = createElement('li', '<h5>Error! No internet connection?</h5>');\n\n        this.els.result.append(li);\n      });\n  }\n\n  createList(response) {\n    const ul = this.els.result;\n\n    response.forEach((row) => {\n      let addressHtml;\n\n      switch (this.options.provider) {\n        case PROVIDERS.OSM:\n          addressHtml = `<span class=\"${klasses.road}\">${row.address.name}</span>`;\n          break;\n\n        default:\n          addressHtml = this.addressTemplate(row.address);\n      }\n\n      if (response.length === 1) {\n        // #206 Direct access if options.limit: 1\n        this.chosen(row, addressHtml, row.address, row.original);\n      } else {\n        const li = createElement('li', `<a href=\"#\">${addressHtml}</a>`);\n\n        li.addEventListener(\n          'click',\n          (evt) => {\n            evt.preventDefault();\n            this.chosen(row, addressHtml, row.address, row.original);\n          },\n          false\n        );\n\n        ul.append(li);\n      }\n    });\n  }\n\n  chosen(place, addressHtml, addressObj, addressOriginal) {\n    const map = this.Base.getMap();\n    const coord_ = [Number.parseFloat(place.lon), Number.parseFloat(place.lat)];\n    const projection = map.getView().getProjection();\n    const coord = proj.transform(coord_, 'EPSG:4326', projection);\n\n    let {\n      bbox\n    } = place;\n\n    if (bbox) {\n      bbox = proj.transformExtent(\n        // #274 https://nominatim.org/release-docs/latest/api/Output/#boundingbox\n        // Requires parseFloat on negative bbox entries\n        [parseFloat(bbox[2]), parseFloat(bbox[0]), parseFloat(bbox[3]), parseFloat(bbox[1])], // SNWE -> WSEN\n        'EPSG:4326',\n        projection\n      );\n    }\n\n    const address = {\n      formatted: addressHtml,\n      details: addressObj,\n      original: addressOriginal,\n    };\n\n    this.clearResults(true); // #284\n\n    // #239\n    if (this.options.preventDefault === true || this.options.preventMarker === true) {\n      // No display change\n      this.Base.dispatchEvent({\n        type: EVENT_TYPE.ADDRESSCHOSEN,\n        address,\n        coordinate: coord,\n        bbox,\n        place,\n      });\n    } else {\n      // Display a marker\n      const feature = this.createFeature(coord, address);\n\n      this.Base.dispatchEvent({\n        type: EVENT_TYPE.ADDRESSCHOSEN,\n        address,\n        feature,\n        coordinate: coord,\n        bbox,\n        place,\n      });\n    }\n\n    // #239\n    if (this.options.preventDefault !== true && this.options.preventPanning !== true) {\n      // Move & zoom to the position\n      if (bbox) {\n        map.getView().fit(bbox, {\n          duration: 500,\n        });\n      } else if (this.options.defaultFlyZoom) {\n        map.getView().animate({\n          center: coord,\n          // #235 ol-geocoder results are too much zoomed in\n          zoom: this.options.defaultFlyZoom,\n          duration: 500,\n        });\n      } else {\n        map.getView().animate({\n          center: coord,\n          // #235 ol-geocoder results are too much zoomed in\n          resolution: this.options.defaultFlyResolution,\n          duration: 500,\n        });\n      }\n    }\n  }\n\n  createFeature(coord) {\n    const feature = new Feature(new Point(coord));\n\n    this.addLayer();\n    feature.setStyle(this.options.featureStyle);\n    feature.setId(randomId('geocoder-ft-'));\n    this.getSource().addFeature(feature);\n\n    return feature;\n  }\n\n  addressTemplate(address) {\n    const html = [];\n\n    if (address.name) {\n      html.push(['<span class=\"', klasses.road, '\">{name}</span>'].join(''));\n    }\n\n    if (address.road || address.building || address.house_number) {\n      html.push(\n        ['<span class=\"', klasses.road, '\">{building} {road} {house_number}</span>'].join('')\n      );\n    }\n\n    if (address.city || address.town || address.village) {\n      html.push(\n        ['<span class=\"', klasses.city, '\">{postcode} {city} {town} {village}</span>'].join('')\n      );\n    }\n\n    if (address.state || address.country) {\n      html.push(['<span class=\"', klasses.country, '\">{state} {country}</span>'].join(''));\n    }\n\n    return template(html.join('<br>'), address);\n  }\n\n  newProvider() {\n    switch (this.options.provider) {\n      case PROVIDERS.OSM:\n        return new OpenStreet(this.options);\n      case PROVIDERS.MAPQUEST:\n        return new MapQuest();\n      case PROVIDERS.PHOTON:\n        return new Photon();\n      case PROVIDERS.BING:\n        return new Bing();\n      case PROVIDERS.OPENCAGE:\n        return new OpenCage();\n\n      default:\n        return this.options.provider;\n    }\n  }\n\n  expand() {\n    removeClass(this.els.input, klasses.spin);\n    addClass(this.els.control, klasses.glass.expanded);\n    window.setTimeout(() => this.els.input.focus(), 100);\n    this.listenMapClick();\n  }\n\n  collapse() {\n    this.els.input.value = '';\n    this.els.input.blur();\n    addClass(this.els.search, klasses.hidden);\n    removeClass(this.els.control, klasses.glass.expanded);\n    removeAllChildren(this.els.result); // #284\n  }\n\n  listenMapClick() {\n    // already registered\n    if (this.registeredListeners.mapClick) return;\n\n    const that = this;\n    const mapElement = this.Base.getMap().getTargetElement();\n\n    this.registeredListeners.mapClick = true;\n\n    // one-time fire click\n    mapElement.addEventListener(\n      'click', {\n        handleEvent(evt) {\n          that.clearResults(true);\n          mapElement.removeEventListener(evt.type, this, false);\n          that.registeredListeners.mapClick = false;\n        },\n      },\n      false\n    );\n  }\n\n  clearResults(collapse) {\n    collapse && this.options.targetType === TARGET_TYPE.GLASS ?\n      this.collapse() :\n      removeAllChildren(this.els.result);\n  }\n\n  getSource() {\n    return this.layer.getSource();\n  }\n\n  addLayer() {\n    let found = false;\n\n    const map = this.Base.getMap();\n\n    map.getLayers().forEach((layer) => {\n      if (layer === this.layer) found = true;\n    });\n\n    if (!found) map.addLayer(this.layer);\n  }\n}","import Control from 'ol/control/Control';\nimport Style from 'ol/style/Style';\nimport Icon from 'ol/style/Icon';\n\nimport {\n  CONTROL_TYPE,\n  DEFAULT_OPTIONS,\n  FEATURE_SRC,\n} from './konstants';\n\nimport Html from './html';\nimport Nominatim from './nominatim';\nimport {\n  assert,\n} from './helpers/mix';\n\n/**\n * @class Base\n * @extends {ol.control.Control}\n */\nexport default class Base extends Control {\n  /**\n   * @constructor\n   * @param {string} type nominatim|reverse.\n   * @param {object} options Options.\n   */\n  constructor(type = CONTROL_TYPE.NOMINATIM, options = {}) {\n    assert(typeof type === 'string', '@param `type` should be string!');\n    assert(\n      type === CONTROL_TYPE.NOMINATIM || type === CONTROL_TYPE.REVERSE,\n      `@param 'type' should be '${CONTROL_TYPE.NOMINATIM}'\n      or '${CONTROL_TYPE.REVERSE}'!`\n    );\n    assert(typeof options === 'object', '@param `options` should be object!');\n\n    let container;\n    let $nominatim;\n    const $html = new Html(options);\n\n    if (type === CONTROL_TYPE.NOMINATIM) {\n      container = $html.els.container;\n    }\n\n    super({\n      element: container,\n      ...options, // Allows to add ol.control.Control options (as target:)\n    });\n\n    this.container = container;\n    this.options = {\n      ...DEFAULT_OPTIONS,\n      featureStyle: [\n        new Style({\n          image: new Icon({\n            anchor: [0.5, 1], // #285\n            src: FEATURE_SRC,\n          })\n        }),\n      ],\n      ...options,\n    };\n\n    if (type === CONTROL_TYPE.NOMINATIM) {\n      $nominatim = new Nominatim(this, $html.els);\n      this.layer = $nominatim.layer;\n    }\n  }\n\n  /**\n   * @return {ol.layer.Vector} Returns the layer created by this control\n   */\n  getLayer() {\n    return this.layer;\n  }\n\n  /**\n   * @return {ol.source.Vector} Returns the source created by this control\n   */\n  getSource() {\n    return this.getLayer().getSource();\n  }\n\n  /**\n   * Set a new provider\n   * @param {String} provider\n   */\n  setProvider(provider) {\n    this.options.provider = provider;\n  }\n\n  /**\n   * Set provider key\n   * @param {String} key\n   */\n  setProviderKey(key) {\n    this.options.key = key;\n  }\n\n  /**\n   * @return {String} Returns the version & build date\n   */\n  getVersion() {\n    return '__geocoderBuildVersion__';\n  }\n}"],"names":["EVENT_TYPE","CONTROL_TYPE","TARGET_TYPE","PROVIDERS","APIS","DEFAULT_OPTIONS","provider","label","placeholder","featureStyle","targetType","lang","limit","keepOpen","preventDefault","preventPanning","preventMarker","defaultFlyResolution","debug","assert","condition","message","Error","randomId","prefix","id","window","performance","nowOffset","Date","now","timing","navigationStart","toString","addClass","element","classname","timeout","Array","isArray","forEach","each","array","split","i","length","hasClass","_addClass","removeClass","_removeClass","c","classList","contains","classRegex","test","className","removeAllChildren","node","firstChild","remove","template","html","row","replace","htm","key","value","undefined","String","replaceAll","createElement","elem","document","attr","setAttribute","name","innerHTML","frag","createDocumentFragment","childNodes","append","RegExp","el","klass","add","trim","klasses","VARS","Html","constructor","options","this","els","createControl","container","containerClass","elements","namespace","inputText","input","control","querySelector","search","result","glass","button","json","obj","Promise","resolve","reject","url","data","toQueryString","encodeUrlXhr","config","method","mode","credentials","jsonp","callback","head","script","callbackName","Math","round","random","indexOf","setTimeout","removeChild","fetch","then","r","catch","Object","keys","reduce","acc","k","push","encodeURIComponent","join","olControl","hidden","icon","Bing","settings","params","query","includeNeighborhood","maxResults","getParameters","handleResponse","results","resources","resourceSets","map","lon","point","coordinates","lat","address","original","formatted","formattedAddress","details","MapQuest","q","format","addressdetails","countrycodes","neighbourhood","road","postcode","city","town","state","country","display_name","OpenCage","countrycode","pretty","no_annotations","geometry","lng","components","house_number","OpenStreet","viewbox","opt","bbox","boundingbox","houseNumber","Photon","langs","toLowerCase","includes","features","properties","Nominatim","base","Base","layerName","layer","LayerVector","background","source","SourceVector","displayInLayerSwitcher","newProvider","registeredListeners","mapClick","setListeners","openSearch","evt","stopPropagation","expanded","collapse","expand","addEventListener","target","which","keyCode","focus","parameters","clearResults","spin","ajax","res","console","info","res_","createList","listenMapClick","li","response","ul","addressHtml","addressTemplate","chosen","place","addressObj","addressOriginal","getMap","coord_","Number","parseFloat","projection","getView","getProjection","coord","proj","transform","transformExtent","dispatchEvent","type","coordinate","feature","createFeature","fit","duration","defaultFlyZoom","animate","center","zoom","resolution","Feature","Point","addLayer","setStyle","setId","getSource","addFeature","building","village","blur","that","mapElement","getTargetElement","handleEvent","removeEventListener","found","getLayers","Control","$nominatim","$html","super","Style","image","Icon","anchor","src","getLayer","setProvider","setProviderKey","getVersion"],"mappings":"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"}